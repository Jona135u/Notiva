<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Notiva</title>
<style>
  :root{
    --bg:#fffaf9;
    --sidebar:#bc6256;
    --sidebar-2:#c97366;
    --accent:#a94f44;
    --card:#ffffff;
    --text:#2b2b2b;
    --muted:#6b6b6b;
    --shadow: 0 6px 18px rgba(0,0,0,.08);
    --radius: 14px;

    --sidebar-collapsed-w: 56px;
  }
  [data-theme="sea"]{
    --bg:#f7fbff;
    --sidebar:#1f6f8b;
    --sidebar-2:#2e8fb3;
    --accent:#14586e;
    --card:#ffffff;
    --text:#1f2a32;
    --muted:#62727d;
  }
  /* Mørkere grå for bedre kontrast */
  [data-theme="clean"]{
    --bg:#fbfbfc;
    --sidebar:#b9bdc4;
    --sidebar-2:#c7cbd2;
    --accent:#636a75;
    --card:#ffffff;
    --text:#222;
    --muted:#59626f;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    background:var(--bg); color:var(--text);
    display:grid; grid-template-columns:260px 1fr; min-height:100dvh;
    transition:grid-template-columns .25s ease;
  }
  body.sidebar-collapsed{ grid-template-columns: var(--sidebar-collapsed-w) 1fr; }

  /* Sidebar */
  aside{
    background:linear-gradient(180deg,var(--sidebar) 0,var(--sidebar-2) 100%);
    padding:18px;
    position:relative;
    overflow:hidden;
    transition:padding .25s ease;
  }
  body.sidebar-collapsed aside{ padding:10px 8px; }

  /* Logo i hvid afrundet firkant */
  .logo{
    display:flex; justify-content:center; align-items:center;
    height:64px; margin-bottom:10px; cursor:pointer;
  }
  .logo-box{
    background:#fff; color:#000; border-radius:12px; padding:8px 16px;
    font-weight:900; font-size:20px; letter-spacing:2px; line-height:1;
    box-shadow:var(--shadow); user-select:none;
  }
  /* Skjul logo når menu er klappet sammen */
  body.sidebar-collapsed .logo{ display:none; }

  /* Skjul “when-expanded” når kollapset */
  body.sidebar-collapsed .when-expanded{ display:none !important; }

  nav{margin-top:4px}
  .menu-title{color:#fff; font-weight:700; margin:0 6px 10px 6px}
  .nav-btn{
    width:100%; text-align:left; padding:12px 14px; border:none; border-radius:10px;
    background:rgba(255,255,255,.25); color:#fff; font-size:16px; cursor:pointer;
    margin:9px 0; backdrop-filter: blur(4px);
    transition:transform .15s ease, background .2s ease;
  }
  .nav-btn:hover{ transform:translateY(-1px) }
  .nav-btn.active{background:rgba(255,255,255,.45); font-weight:700}

  .palettes{ position:absolute; left:18px; right:18px; bottom:84px; }
  /* Fjern label/tekst for paletten helt */
  .palettes label{ display:none !important; }
  .swatches{display:flex; gap:10px}
  .swatch{
    height:28px; width:28px; border-radius:50%; border:2px solid rgba(255,255,255,.9);
    cursor:pointer; box-shadow:var(--shadow);
  }
  .swatch[data-set="default"]{background:linear-gradient(135deg,#bc6256,#c97366)}
  .swatch[data-set="sea"]{background:linear-gradient(135deg,#1f6f8b,#2e8fb3)}
  .swatch[data-set="clean"]{background:linear-gradient(135deg,#aeb4bd,#d0d5dc)}

  .edit-area{
    position:absolute; left:18px; right:18px; bottom:18px; display:flex; gap:10px;
  }
  .edit-btn,.add-tpl{
    flex:1; padding:10px 12px; border:none; border-radius:10px; cursor:pointer;
    background:#fff; color:var(--accent); font-weight:700;
    transition:transform .1s ease; 
  }
  .edit-btn:active,.add-tpl:active{ transform:scale(.98); }

  /* Den smalle stribe når menuen er skjult */
  .stripe{
    position:fixed; left:0; top:0; bottom:0; width:12px; background:linear-gradient(180deg,var(--sidebar),var(--sidebar-2));
    cursor:pointer; z-index:50; box-shadow:2px 0 10px rgba(0,0,0,.08);
    display:none;
  }
  body.sidebar-collapsed .stripe{ display:block; }
  .stripe::after{
    content:""; position:absolute; top:50%; left:2px; transform:translateY(-50%);
    width:8px; height:40px; border-radius:6px; background:rgba(255,255,255,.55);
  }

  /* Main */
  main{padding:28px 36px 120px 36px}
  h1{margin:0 0 10px 0; font-size:42px; color:var(--accent)}
  .helper{color:var(--muted); margin:0 0 18px 0}
  .home-editor{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
    padding:16px; min-height:180px; outline:none; border:1px solid #ececec;
  }
  .tpl-header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin:8px 0 16px}
  .tpl-header input{
    font-size:22px; font-weight:700; border:none; background:transparent; color:var(--accent); outline:none;
  }
  .boxes{display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:16px}
  .box{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
    padding:12px; border:2px solid transparent; position:relative;
    transition:border-color .15s ease, transform .15s ease;
  }
  .box:hover{ transform:translateY(-1px); }
  .box.selected{border-color:var(--accent)}
  .box-title{
    width:100%; border:none; border-bottom:1px dashed #ddd; padding:6px 4px; outline:none; font-weight:700;
  }
  .box textarea{
    width:100%; min-height:120px; border:none; outline:none; resize:vertical; padding:8px 4px; color:var(--text); background:transparent;
  }
  .box-actions{display:flex; gap:8px; margin-top:8px}
  .small-btn{
    border:none; border-radius:8px; padding:8px 10px; cursor:pointer;
    background:#f3f4f6; color:#333; transition:transform .1s ease;
  }
  .small-btn:active{ transform:scale(.98); }

  .add-box{
    margin-top:4px; border:none; border-radius:10px; padding:10px 12px; cursor:pointer;
    background:var(--accent); color:#fff; box-shadow:var(--shadow);
  }
  .delete-tpl{
    border:none; background:#ffe9e7; color:#aa2a1e; padding:8px 10px; border-radius:10px; cursor:pointer; display:none;
  }

  /* Floating mic */
  .mic{
    position:fixed; left:50%; transform:translateX(-50%); bottom:20px; z-index:30;
    height:64px; width:64px; border-radius:50%;
    background:var(--accent); color:#fff; display:grid; place-items:center;
    box-shadow:0 10px 30px rgba(0,0,0,.25); border:none; cursor:pointer;
  }
  .mic.recording{animation:pulse .8s ease-in-out infinite}
  @keyframes pulse{
    0%{box-shadow:0 0 0 0 rgba(169,79,68,.45)}
    70%{box-shadow:0 0 0 18px rgba(169,79,68,0)}
    100%{box-shadow:0 0 0 0 rgba(169,79,68,0)}
  }

  /* Add-template modal (uændret) */
  .modal{
    position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:40;
  }
  .modal-inner{
    width:min(520px,92vw); background:#fff; border-radius:16px; box-shadow:var(--shadow); padding:18px;
  }
  .modal.show{display:flex}
  .row{display:flex; gap:10px; margin-top:10px}
  .row input{flex:1; padding:10px; border-radius:10px; border:1px solid #ddd}
  .row button{padding:10px 12px; border-radius:10px; border:none; background:var(--accent); color:#fff; cursor:pointer}
  .muted{color:var(--muted); font-size:13px}

  /* Rediger-OVERLAY (nyt) */
  .edit-overlay{
    position:fixed; inset:0;
    background:rgba(0,0,0,.6);
    display:none; align-items:center; justify-content:center; flex-direction:column;
    z-index:60;
  }
  .edit-overlay.show{ display:flex; animation:fadeIn .2s ease; }
  @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

  .overlay-title{ color:#fff; font-weight:800; margin:0 0 16px; }
  .overlay-grid{
    width:min(780px,92vw);
    display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:14px;
    margin-bottom:14px;
  }
  .overlay-card{
    background:#fff; border-radius:12px; box-shadow:var(--shadow);
    padding:12px; text-align:center;
  }
  .overlay-card-name{ font-weight:700; margin-bottom:8px; }
  .overlay-card button{
    border:none; border-radius:10px; padding:8px 10px; cursor:pointer;
    background:#ffe9e7; color:#aa2a1e; font-weight:700;
  }
  .overlay-close{
    border:none; border-radius:12px; padding:10px 16px; font-weight:800; cursor:pointer;
    background:#fff; color:var(--accent); box-shadow:var(--shadow);
  }

  /* Mobil */
  @media (max-width:820px){
    body{ grid-template-columns:1fr }
    aside{
      position:fixed; left:0; top:0; bottom:0; width:82vw;
      transform:translateX(0);
      transition:transform .25s ease;
    }
    body.sidebar-collapsed aside{ transform:translateX(-100%); }
    main{ padding:22px 16px 100px; }
    h1{ font-size:32px }
    .boxes{ grid-template-columns:repeat(auto-fill,minmax(210px,1fr)); gap:12px }
    .mic{ height:56px; width:56px }
  }
</style>
</head>
<body>
  <!-- Stribe til at åbne menuen når den er kollapset -->
  <div class="stripe" id="stripe"></div>

  <aside id="sidebar">
    <!-- Klikbart logo i hvid afrundet firkant -->
    <div class="logo" id="homeLink" title="Til forsiden">
      <div class="logo-box">NOTIVA</div>
    </div>

    <div class="when-expanded">
      <nav id="nav">
        <div class="menu-title">Menu</div>
        <!-- Knapper indsættes af JS -->
      </nav>

      <div class="palettes">
        <!-- label er fjernet -->
        <div class="swatches">
          <div class="swatch" data-set="default" title="Standard"></div>
          <div class="swatch" data-set="sea" title="Sea vibe"></div>
          <div class="swatch" data-set="clean" title="Grå/hvid clean"></div>
        </div>
      </div>

      <div class="edit-area">
        <button class="add-tpl" id="addTplBtn">Tilføj skabelon</button>
        <button class="edit-btn" id="toggleEdit">Rediger</button>
      </div>
    </div>
  </aside>

  <main id="main">
    <!-- Home -->
    <section id="home">
      <h1>Info og Deadlines</h1>
      <p class="helper">Her kan du samle vigtige datoer og information.</p>
      <div id="homeEditor" class="home-editor" contenteditable="true" data-placeholder="Skriv dine noter her..."></div>
    </section>

    <!-- Template view -->
    <section id="tplView" style="display:none">
      <div class="tpl-header">
        <input id="tplTitle" />
        <div class="tpl-actions">
          <button class="delete-tpl" id="deleteTpl">Slet skabelon</button>
        </div>
      </div>
      <div class="boxes" id="boxes"></div>
      <button class="add-box" id="addBox">Tilføj boks</button>
    </section>
  </main>

  <button class="mic" id="micBtn" title="Tal til den valgte boks" aria-label="Start/Stop tale-til-tekst">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 1a3 3 0 0 0-3 3v6a3 3 0 1 0 6 0V4a3 3 0 0 0-3-3z"/>
      <path d="M19 10a7 7 0 0 1-14 0"/>
      <path d="M12 17v6"/>
    </svg>
  </button>

  <!-- Add-template modal -->
  <div class="modal" id="modal">
    <div class="modal-inner">
      <h3>Ny skabelon</h3>
      <div class="row">
        <input id="newTplName" placeholder="Navn på skabelon (fx Søvn, Skole…)" />
        <button id="createTpl">Opret</button>
      </div>
      <p class="muted">Du kan slette/redigere skabeloner under “Rediger”.</p>
    </div>
  </div>

  <!-- Rediger overlay (nyt) -->
  <div class="edit-overlay" id="editOverlay">
    <h2 class="overlay-title">Skabeloner</h2>
    <div class="overlay-grid" id="overlayGrid"></div>
    <button class="overlay-close" id="overlayDone">Færdig</button>
  </div>

<script>
/* ---------- Data & state ---------- */
const DEFAULT_TEMPLATES = ["Kost","Medicin","Kognitiv","Mobilitet","Noter"];
const STORAGE_KEY = "notiva_v1_overlay";

let state = loadState() || {
  theme: "default",
  templates: [...DEFAULT_TEMPLATES],
  homeContent: "",
  pages: {}
};
let currentPage = "home";
let selectedBoxId = null;

function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function loadState(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)); }catch(e){ return null; }
}
function uid(){ return Math.random().toString(36).slice(2,9); }

/* ---------- Init ---------- */
applyTheme(state.theme);
renderNav();
renderHome();

document.getElementById("homeLink").addEventListener("click", () => { openHome(); expandSidebar(); });

document.getElementById("toggleEdit").addEventListener("click", openEditOverlay);
document.getElementById("overlayDone").addEventListener("click", closeEditOverlay);

document.getElementById("addTplBtn").addEventListener("click", () => showModal(true));
document.getElementById("createTpl").addEventListener("click", createTemplate);
document.getElementById("deleteTpl").addEventListener("click", deleteCurrentTemplate);
document.getElementById("addBox").addEventListener("click", addBox);

/* Paletter (kun cirkler) */
document.querySelectorAll(".swatch").forEach(s => {
  s.addEventListener("click", () => {
    const set = s.dataset.set;
    const theme = set === "default" ? "default" : set;
    applyTheme(theme);
    state.theme = theme;
    saveState();
  });
});

/* Stribe åbner menu */
document.getElementById("stripe").addEventListener("click", expandSidebar);

/* ---------- Navigation ---------- */
function renderNav(){
  const nav = document.getElementById("nav");
  if(!nav) return;
  nav.querySelectorAll(".nav-btn").forEach(b => b.remove());

  const startBtn = button("Start", () => { openHome(); expandSidebar(); });
  startBtn.classList.add("nav-btn");
  if(currentPage === "home") startBtn.classList.add("active");
  nav.appendChild(startBtn);

  state.templates.forEach(name => {
    const btn = button(name, () => openTemplate(name));
    btn.className = "nav-btn" + (currentPage === name ? " active" : "");
    nav.appendChild(btn);
  });
}
function button(text, onClick){
  const b = document.createElement("button");
  b.textContent = text; b.className="nav-btn"; b.addEventListener("click",onClick);
  return b;
}

/* ---------- Home ---------- */
function renderHome(){
  showSection("home");
  currentPage = "home";
  renderNav();
  const ed = document.getElementById("homeEditor");
  ed.innerHTML = state.homeContent || "";
  ed.oninput = () => { state.homeContent = ed.innerHTML; saveState(); };
}

/* ---------- Templates ---------- */
function ensurePage(name){
  if(!state.pages[name]){
    state.pages[name] = { title:name, boxes:[] };
  }
}
function openTemplate(name){
  ensurePage(name);
  currentPage = name; selectedBoxId = null;
  showSection("tplView");
  renderNav();
  collapseSidebar(); // skjul menuen i skabelonview

  const page = state.pages[name];
  const titleInput = document.getElementById("tplTitle");
  titleInput.value = page.title;
  titleInput.oninput = () => { page.title = titleInput.value.trim() || name; saveState(); renderNav(); };

  const delBtn = document.getElementById("deleteTpl");
  // Del-knap i header er valgfri; overlay håndterer slet samlet
  delBtn.style.display = "none";

  const boxes = document.getElementById("boxes");
  boxes.innerHTML = "";
  page.boxes.forEach(b => boxes.appendChild(renderBox(b, page)));
}

function showSection(id){
  document.getElementById("home").style.display = (id==="home") ? "block" : "none";
  document.getElementById("tplView").style.display = (id==="tplView") ? "block" : "none";
}

function renderBox(b, page){
  const el = document.createElement("div");
  el.className = "box";
  el.dataset.id = b.id;

  const title = document.createElement("input");
  title.className = "box-title";
  title.value = b.title || "Uden navn";
  title.placeholder = "Navn på boks";
  title.oninput = () => { b.title = title.value; saveState(); };

  const ta = document.createElement("textarea");
  ta.value = b.text || "";
  ta.oninput = () => { b.text = ta.value; saveState(); };

  el.addEventListener("click", () => {
    selectedBoxId = b.id;
    document.querySelectorAll(".box").forEach(x=>x.classList.remove("selected"));
    el.classList.add("selected");
  });

  const actions = document.createElement("div");
  actions.className = "box-actions";
  const clearBtn = document.createElement("button");
  clearBtn.textContent = "Ryd";
  clearBtn.className = "small-btn";
  clearBtn.onclick = () => { ta.value=""; b.text=""; saveState(); };

  const rmBtn = document.createElement("button");
  rmBtn.textContent = "Fjern";
  rmBtn.className = "small-btn";
  rmBtn.onclick = () => {
    page.boxes = page.boxes.filter(x => x.id !== b.id);
    if(selectedBoxId===b.id) selectedBoxId=null;
    saveState(); openTemplate(currentPage);
  };

  actions.append(clearBtn, rmBtn);
  el.append(title, ta, actions);
  return el;
}

function addBox(){
  if(currentPage==="home") return;
  const page = state.pages[currentPage];
  page.boxes.push({ id:uid(), title:"Ny boks", text:"" });
  saveState(); openTemplate(currentPage);
}

/* Template management – Add modal */
function showModal(show){ document.getElementById("modal").classList.toggle("show", !!show); }
document.getElementById("modal").addEventListener("click", (e)=>{ if(e.target.id==="modal") showModal(false); });

function createTemplate(){
  const name = (document.getElementById("newTplName").value || "").trim();
  if(!name) return;
  if(state.templates.includes(name) || name==="Start" || name==="home"){ alert("Navnet bruges allerede."); return; }
  state.templates.push(name);
  ensurePage(name); saveState();
  document.getElementById("newTplName").value = "";
  showModal(false);
  openTemplate(name);
}
function deleteCurrentTemplate(){
  // Ikke i brug nu (overlay bruges i stedet)
  if(!state.templates.includes(currentPage)) return;
  if(!confirm("Slet skabelon og alt indhold?")) return;
  state.templates = state.templates.filter(t => t!==currentPage);
  delete state.pages[currentPage];
  saveState(); openHome(); expandSidebar();
}
function openHome(){ renderHome(); }

/* ---------- Sidebar collapse/expand ---------- */
function collapseSidebar(){ document.body.classList.add("sidebar-collapsed"); }
function expandSidebar(){ document.body.classList.remove("sidebar-collapsed"); }

/* ---------- Theme ---------- */
function applyTheme(theme){
  document.documentElement.removeAttribute("data-theme");
  if(theme==="sea") document.documentElement.setAttribute("data-theme","sea");
  if(theme==="clean") document.documentElement.setAttribute("data-theme","clean");
}

/* ---------- Rediger overlay (nyt) ---------- */
const editOverlay = document.getElementById("editOverlay");
const overlayGrid = document.getElementById("overlayGrid");

function openEditOverlay(){
  // Fyld grid med kort for ALLE skabeloner
  overlayGrid.innerHTML = "";
  state.templates.forEach(name=>{
    const card = document.createElement("div");
    card.className = "overlay-card";
    const title = document.createElement("div");
    title.className = "overlay-card-name";
    title.textContent = name;
    const del = document.createElement("button");
    del.textContent = "Slet";
    del.onclick = ()=>{
      // Slet skabelon + side
      state.templates = state.templates.filter(t=>t!==name);
      delete state.pages[name];
      saveState();
      renderNav();
      if(currentPage===name){ openHome(); }
      // Opdater overlayets grid
      openEditOverlay();
    };
    card.append(title, del);
    overlayGrid.append(card);
  });
  editOverlay.classList.add("show");
}

function closeEditOverlay(){
  editOverlay.classList.remove("show");
}

/* ---------- Speech-to-text ---------- */
const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
const mic = document.getElementById("micBtn");
let rec = null; let listening = false;

if(!SpeechRec){
  mic.disabled = true;
  mic.title = "Tale-til-tekst understøttes ikke i denne browser.";
}else{
  rec = new SpeechRec();
  rec.lang = "da-DK";
  rec.interimResults = false;
  rec.continuous = false;

  rec.onresult = (e)=>{
    const text = Array.from(e.results).map(r=>r[0].transcript).join(" ");
    if(!selectedBoxId){ return; }
    const page = state.pages[currentPage];
    const box = page.boxes.find(b=>b.id===selectedBoxId);
    if(!box){ return; }
    box.text = (box.text ? box.text + " " : "") + text;
    saveState();
    const node = document.querySelector(`.box[data-id="${selectedBoxId}"] textarea`);
    if(node){ node.value = box.text; }
  };
  rec.onstart = ()=> mic.classList.add("recording");
  rec.onend   = ()=> { mic.classList.remove("recording"); listening=false; }
  rec.onerror = ()=> { mic.classList.remove("recording"); listening=false; }
}

mic.addEventListener("click", ()=>{
  if(!rec){ return; }
  if(currentPage==="home"){ alert("Vælg en boks i en skabelon først."); return; }
  if(!selectedBoxId){ alert("Tryk på den boks du vil indtale til."); return; }
  if(!listening){ try{ rec.start(); listening=true; }catch{} }
  else{ try{ rec.stop(); listening=false; }catch{} }
});
</script>
</body>
</html>
